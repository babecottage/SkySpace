---
// @ts-ignore
import { ATP } from "../utils/atp";
const { BskyAgent } = ATP;

import Card from "./Card.astro";
const agent = new BskyAgent({
  service: "https://bsky.social",
  // persistSession: (evt: AtpSessionEvent, sess?: AtpSessionData) => {

  // },
});

await agent.login({
  identifier: import.meta.env.BSKY_USERNAME!,
  password: import.meta.env.BSKY_PASSWORD!,
});

const topEight = await agent
  .getProfiles({
    actors: Astro.props.topEight,
  })
  .then((r) => r.data.profiles);
---

<Card>
  <h3>{Astro.props.data.displayName}â€™s Friend Space</h3>
  <p>
    {Astro.props.data.displayName} has {Astro.props.data.followersCount} friends
  </p>
  <ul class="grid sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-3">
    {
      topEight.map((profile) => {
        return (
          <li class="overflow-hidden">
            <a href={`/profile/${profile.handle}`}>
              <img src={profile.avatar} />
              <h3 class="sm:text-xs overflow-wrap">{profile.displayName}</h3>
            </a>
          </li>
        );
      })
    }
  </ul>
</Card>
